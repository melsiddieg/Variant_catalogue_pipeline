process.executor = 'slurm'
process.cache = 'lenient'
process.queue='silent_q'
process.shell = ['/bin/bash','-e']
executor { queueSize = 30 }

env {
	NXF_EXECUTOR = "slurm"
}

launchDir = "/mnt/scratch/SILENT/Act3/Processed/Workflow/Version_0.0.0/"

params {
	run             		= "Run_20220302"
	batch           		= "Batch_DryRun"
	SNV				= "SNV"
        reads           		= "/mnt/scratch/SILENT/Act3/GSC_data/Dry_run/*.{R1,R2}.fastq.gz"
	outdir_ind      		= "/mnt/scratch/SILENT/Act3/Processed/Individual/"
        outdir_pop      		= "/mnt/scratch/SILENT/Act3/Processed/Population"
	ref_genome_MT   		= "/mnt/common/SILENT/Act3/MT_references/Homo_sapiens_assembly38.chrM.fasta"
	ref_genome_MT_index 		= "/mnt/common/SILENT/Act3/MT_references/Homo_sapiens_assembly38.chrM.fasta.fai"
	ref_genome_MT_dict 		= "/mnt/common/SILENT/Act3/MT_references/Homo_sapiens_assembly38.chrM.dict"
	ref_genome_MT_shifted		= "/mnt/common/SILENT/Act3/MT_references/Homo_sapiens_assembly38.chrM.shifted_by_8000_bases.fasta"
	ref_genome_MT_shifted_index 	= "/mnt/common/SILENT/Act3/MT_references/Homo_sapiens_assembly38.chrM.shifted_by_8000_bases.fasta.fai"
	ref_genome_MT_shifted_dict 	= "/mnt/common/SILENT/Act3/MT_references/Homo_sapiens_assembly38.chrM.shifted_by_8000_bases.dict"
	vep_cache_merged		= "/mnt/common/SILENT/Act3/VEP/"
	vep_cache_merged_version	= "105"
	params.assembly_MT              = 'GRCh38'
	blacklist_sites_hg38_MT		= "/mnt/common/SILENT/Act3/MT_references/blacklist_sites.hg38.chrM.bed"
	blacklist_sites_hg38_MT_index	= "/mnt/common/SILENT/Act3/MT_references/blacklist_sites.hg38.chrM.bed.idx"
	ShiftBack_chain			= "/mnt/common/SILENT/Act3/MT_references/ShiftBack.chain"
	gnomad_MT_frequ			= "/mnt/common/SILENT/Act3/MT_references/gnomad.genomes.v3.1.sites.chrM.reduced_annotations.tsv"
	sex_file			= "/mnt/scratch/SILENT/Act3/Processed/Workflow/Version_0.0.0/sample_sex.tsv"
	chrom				= (1..22) +  ['X', 'Y']
	chrM				= 'chrM'
}


profiles {

        GRCh37 {
		params.assembly				= 'GRCh37'
                params.ref				= '/mnt/common/DATABASES/REFERENCES/GRCh37/GENOME/GRCh37-lite.fa'
                params.ref_index			= '/mnt/common/DATABASES/REFERENCES/GRCh37/GENOME/GRCh37-lite.fa.fai'
                params.Mitochondrial_chromosome		= 'MT'
		params.CADD_1_6_whole_genome_SNVs	= '/mnt/common/DATABASES/REFERENCES/GRCh37/CADD/V1.6/whole_genome_SNVs.tsv.gz'
		params.CADD_1_6_whole_genome_SNVs_index = '/mnt/common/DATABASES/REFERENCES/GRCh37/CADD/V1.6/whole_genome_SNVs.tsv.gz.tbi'
		params.CADD_1_6_InDels			= '/mnt/common/DATABASES/REFERENCES/GRCh37/CADD/V1.6/InDels.tsv.gz'
		params.CADD_1_6_InDels_index		= '/mnt/common/DATABASES/REFERENCES/GRCh37/CADD/V1.6/InDels.tsv.gz.tbi'
		params.gnomad_SNV_vcf			= '/mnt/common/DATABASES/REFERENCES/GRCh37/GNOMAD/V2.1.1/gnomad.genomes.r2.1.1.sites.vcf.gz'
		params.gnomad_SNV_index			= '/mnt/common/DATABASES/REFERENCES/GRCh37/GNOMAD/V2.1.1/gnomad.genomes.r2.1.1.sites.vcf.gz.tbi'
		params.gnomad_SNV_vcf_chr20		= '/mnt/common/SILENT/Act3/gnomad/gnomad.genomes.r2.1.1.sites.20.vcf.bgz'
		params.gnomad_SNV_index_chr20		= '/mnt/common/SILENT/Act3/gnomad/gnomad.genomes.r2.1.1.sites.20.vcf.bgz.tbi'        
	}
	

        GRCh38 {
		params.assembly				= 'GRCh38'
                params.ref				= '/mnt/common/DATABASES/REFERENCES/GRCh38/GENOME/1000G/GRCh38_full_analysis_set_plus_decoy_hla.fa'
                params.ref_index			= '/mnt/common/DATABASES/REFERENCES/GRCh38/GENOME/1000G/GRCh38_full_analysis_set_plus_decoy_hla.fa.fai'
		params.Mitochondrial_chromosome		= 'chrM'
                params.CADD_1_6_whole_genome_SNVs       = '/mnt/common/DATABASES/REFERENCES/GRCh38/CADD/V1.6/whole_genome_SNVs.tsv.gz'
                params.CADD_1_6_whole_genome_SNVs_index = '/mnt/common/DATABASES/REFERENCES/GRCh38/CADD/V1.6/whole_genome_SNVs.tsv.gz.tbi'
                params.CADD_1_6_InDels                  = '/mnt/common/DATABASES/REFERENCES/GRCh38/CADD/V1.6/gnomad.genomes.r3.0.indel.tsv.gz'
                params.CADD_1_6_InDels_index            = '/mnt/common/DATABASES/REFERENCES/GRCh38/CADD/V1.6/gnomad.genomes.r3.0.indel.tsv.gz.tbi'
                params.gnomad_SNV_vcf                   = '/mnt/common/DATABASES/REFERENCES/GRCh38/GNOMAD/V3/gnomad.genomes.r3.0.sites.vcf.gz'
                params.gnomad_SNV_index                 = '/mnt/common/DATABASES/REFERENCES/GRCh38/GNOMAD/V3/gnomad.genomes.r3.0.sites.vcf.gz.tbi'
        }
}

singularity {
     enabled = true
     autoMounts = true
     runOptions = "-B /mnt/scratch/SILENT/Act3/ -B /mnt/common/SILENT/Act3/ -B /mnt/common/DATABASES/REFERENCES/"
//   cacheDir = "/mnt/common/SILENT/Act3/singularity"
 }

process {
// 4GB
          withName: 'Vcftools_TsTv_by_qual|align_to_MT|MT_MergeVcfs|MarkDuplicates|MT_merge_samples' {
                memory = 4.GB
        }

// 4GB, 8cpus
          withName: 'Bcftools_stats|annotation_table_merged|SNV_data_organization|split_vcf_by_chr' {
                memory = 4.GB
                cpus = 8
        }

// 12Gb, 8 cpus
	withName: 'sorted_bam_files' {
                memory = 12.GB
                cpus = 8
        }	

// 40GB, 8 cpus
          withName: 'bcf_to_vcf|SNV_data_organisation|bwa_index' {
                memory = 40.GB
                cpus = 8
        }

// 120Gb, 16 cpus
          withName: 'annotation_table' {
                memory = 120.GB
                cpus = 16
        }


//FastQC, 2GB, 4CPUs
        withName: 'fastqc' {
                memory = 2.GB
                cpus = 4
                container = "file:///mnt/common/SILENT/Act3/singularity/fastqc.0.11.sif"
        }

//MultiQC 4GB
        withName: 'multiqc_indiv|multiqc_pop' {
                memory=4.GB
                container = "file:///mnt/common/SILENT/Act3/singularity/multiqc-1.9.sif"
        }

//Mosdepth, 4GB
        withName: 'Mosdepth' {
                memory = 4.GB
                container = "file:///mnt/common/SILENT/Act3/singularity/mosdepth-0.3.2.sif"
        }
     
//DeepVariant
        withName: 'deepvariant_call' {
                memory = 12.GB
                cpus = 4
                container = "file:///mnt/common/SILENT/Act3/singularity/deepvariant-1.2.0.sif"
        }

//GLnexus
        withName: 'GLnexus_cli' {
                memory = 240.GB
                cpus = 40
                container = "file:///mnt/common/SILENT/Act3/singularity/glnexus-1.4.1.sif"
        }

//GATK 4GB
// Solenne : Removed 'MarkDuplicates', 'MT_MergeVcfs' and 'MT_merge_samples' from the list as it also uses conda and was not working with both in the same process 
	withName: 'MT_call_variants|Extract_MT_Read|MT_Filter_Mutect_Calls|MT_FilterOut_sites|MT_LeftAlignAndTrimVariants|MT_Liftover|MT_Merge_stat_file|MT_SamtoFastq|gnomad_frequency_table|count_variants_gatk' {
                memory=4.GB
                container = "file:///mnt/common/SILENT/Act3/singularity/gatk4-4.2.0.sif"
        }

//GATK, 4 CPUs , 8Gb
	withName: 'Picard_CollectWgsMetrics|Picard_CollectWgsMetrics_MT' {
                cpus = 4
		memory=8.GB
                container = "file:///mnt/common/SILENT/Act3/singularity/gatk4-4.2.0.sif"
        }

//GATK, 4 CPUs , 2Gb
        withName: 'Picard_CollectAlignmentSummaryMetrics' {
                cpus = 4
                memory=2.GB
                container = "file:///mnt/common/SILENT/Act3/singularity/gatk4-4.2.0.sif"
        }

// Picard_R, 2Gb, 4 CPUs
        withName: 'Picard_QualityScoreDistribution' {
                cpus=4
                memory=2.GB
                container = "file:///mnt/common/SILENT/Act3/singularity/picard_r.sif"
        }
}
